{"version":3,"sources":["../../../src/util/Spotify.js"],"names":["accessToken","client_id","redirect_uri","Spotify","getAccessToken","newAccessToken","window","location","href","match","newExpiresIn","expiresIn","Number","setTimeout","history","pushState","accessUrl","search","searchTerm","fetch","headers","Authorization","then","response","json","jsonResponse","tracks","items","map","id","track","name","artist","artists","album","uri","savePlaylist","playlistName","trackURIs","userId","method","body","JSON","stringify","playlistID","uris"],"mappings":";;;;;AAAA,IAAIA,oBAAJ;AACA,IAAMC,YAAY,kCAAlB;AACA,IAAMC,eAAe,wBAArB;;AAEA;AACA,IAAMC,UAAU;AACZC,kBADY,4BACK;AACb,YAAIJ,WAAJ,EAAiB;AACb,mBAAOA,WAAP;AACH;AACD,YAAMK,iBAAiBC,OAAOC,QAAP,CAAgBC,IAAhB,CAAqBC,KAArB,CAA2B,sBAA3B,CAAvB;AACA,YAAMC,eAAeJ,OAAOC,QAAP,CAAgBC,IAAhB,CAAqBC,KAArB,CAA2B,oBAA3B,CAArB;AACA,YAAIJ,kBAAkBK,YAAtB,EAAoC;AAChCV,0BAAcK,eAAe,CAAf,CAAd;AACA,gBAAIM,YAAYC,OAAOF,aAAa,CAAb,CAAP,CAAhB;AACA;AACAJ,mBAAOO,UAAP,CAAkB;AAAA,uBAAMb,cAAc,EAApB;AAAA,aAAlB,EAA0CW,YAAY,IAAtD;AACAL,mBAAOQ,OAAP,CAAeC,SAAf,CAAyB,cAAzB,EAAyC,IAAzC,EAA+C,GAA/C;AACA,mBAAOf,WAAP;AACH,SAPD,MAOO;AACH,gBAAIgB,kEAAgEf,SAAhE,wFAA4JC,YAAhK;AACAI,mBAAOC,QAAP,GAAkBS,SAAlB;AACH;AACJ,KAlBW;AAmBZC,UAnBY,kBAmBLC,UAnBK,EAmBO;AACf,eAAOC,MAAM,8FAA2FD,UAA3F,eAAN,EAAwH;AACvHE,qBAAS,EAACC,2BAAyBrB,WAA1B;AAD8G,SAAxH,EAGLsB,IAHK,CAGA,oBAAY;AACf,mBAAOC,SAASC,IAAT,EAAP;AACH,SALM,EAKJF,IALI,CAKC,wBAAgB;AACpB,gBAAIG,aAAaC,MAAjB,EAAyB;AACrB,uBAAOD,aAAaC,MAAb,CAAoBC,KAApB,CAA0BC,GAA1B,CAA8B;AAAA,2BAAU;AACvCC,4BAAIC,MAAMD,EAD6B;AAEvCE,8BAAMD,MAAMC,IAF2B;AAGvCC,gCAAQF,MAAMG,OAAN,CAAc,CAAd,EAAiBF,IAHc;AAIvCG,+BAAOJ,MAAMI,KAAN,CAAYH,IAJoB;AAKvCI,6BAAKL,MAAMK;AAL4B,qBAAV;AAAA,iBAA9B,CAAP;AASH,aAVD,MAUO;AACH;AACA,uBAAO,EAAP;AACH;AACJ,SApBM,CAAP;AAqBH,KAzCW;AA0CZC,gBA1CY,wBA0CCC,YA1CD,EA0CeC,SA1Cf,EA0C0B;AAClC,YAAI,EAAED,gBAAgBC,SAAlB,CAAJ,EAAkC;AAC9B;AACH;;AAED,YAAMlB,UAAU;AACZ,6BAAiB,YAAYpB;AADjB,SAAhB;AAGA,YAAIuC,eAAJ;AACApB,cAAM,yCAAyC,+BAA/C,EAAgF,EAACC,SAASA,OAAV,EAAhF,EACKE,IADL,CACU,oBAAY;AACd,mBAAOC,SAASC,IAAT,EAAP;AACH,SAHL,EAGOF,IAHP,CAGY,wBAAgB;AACxB,gBAAI,CAACG,aAAaI,EAAlB,EAAsB;AAClB;AACH;;AAEDU,qBAASd,aAAaI,EAAtB;AACAV,wDAA0CoB,MAA1C,iBAA8D;AAC1DC,wBAAQ,MADkD;AAE1DpB,yBAASA,OAFiD;AAG1DqB,sBAAMC,KAAKC,SAAL,CAAe,EAACZ,MAAMM,YAAP,EAAf;AAHoD,aAA9D,EAIGf,IAJH,CAIQ,oBAAY;AAChB,uBAAOC,SAASC,IAAT,EAAP;AACH,aAND,EAMGF,IANH,CAMQ,wBAAgB;AACpB,oBAAI,CAACG,aAAaI,EAAlB,EAAsB;AAClB;AACH;;AAED,oBAAIe,aAAanB,aAAaI,EAA9B;;AAEAV,4DAA0CoB,MAA1C,mBAA8DK,UAA9D,cAAmF;AAC/EJ,4BAAQ,MADuE;AAE/EpB,6BAASA,OAFsE;AAG/EqB,0BAAMC,KAAKC,SAAL,CAAe,EAACE,MAAMP,SAAP,EAAf;AAHyE,iBAAnF;AAKH,aAlBD;AAoBH,SA7BD;AA8BH;AAjFW,CAAhB;;kBAqFenC,O","file":"Spotify.js","sourcesContent":["let accessToken;\r\nconst client_id = '1061154da1164bbc9b258f51a6642468';\r\nconst redirect_uri = 'http://localhost:3000/';\r\n\r\n//Create a Spotify Module\r\nconst Spotify = {\r\n    getAccessToken() {\r\n        if (accessToken) {\r\n            return accessToken;\r\n        }\r\n        const newAccessToken = window.location.href.match(/access_token=([^&]*)/);\r\n        const newExpiresIn = window.location.href.match(/expires_in=([^&]*)/);\r\n        if (newAccessToken && newExpiresIn) {\r\n            accessToken = newAccessToken[1];\r\n            let expiresIn = Number(newExpiresIn[1]);\r\n            //Clear the parameters from the URL, so the app doesn't try grabbing the access token after it has expired\r\n            window.setTimeout(() => accessToken = '', expiresIn * 1000);\r\n            window.history.pushState('Access Token', null, '/');\r\n            return accessToken;\r\n        } else {\r\n            let accessUrl = `https://accounts.spotify.com/authorize?client_id=${client_id}&response_type=token&scope=playlist-modify-public&show_dialog=true&redirect_uri=${redirect_uri}`;\r\n            window.location = accessUrl;\r\n        }\r\n    },\r\n    search(searchTerm) {\r\n        return fetch('https://cors-anywhere.herokuapp.com/' + `https://api.spotify.com/v1/search?type=track&q=${searchTerm}&limit=10`, {\r\n                headers: {Authorization: `Bearer ${accessToken}`}\r\n            }\r\n        ).then(response => {\r\n            return response.json();\r\n        }).then(jsonResponse => {\r\n            if (jsonResponse.tracks) {\r\n                return jsonResponse.tracks.items.map(track => ({\r\n                        id: track.id,\r\n                        name: track.name,\r\n                        artist: track.artists[0].name,\r\n                        album: track.album.name,\r\n                        uri: track.uri\r\n                    }\r\n\r\n                ));\r\n            } else {\r\n                //return empty array\r\n                return [];\r\n            }\r\n        })\r\n    },\r\n    savePlaylist(playlistName, trackURIs) {\r\n        if (!(playlistName && trackURIs)) {\r\n            return;\r\n        }\r\n\r\n        const headers = {\r\n            'Authorization': 'Bearer ' + accessToken\r\n        };\r\n        let userId;\r\n        fetch('https://cors-anywhere.herokuapp.com/' + 'https://api.spotify.com/v1/me', {headers: headers})\r\n            .then(response => {\r\n                return response.json();\r\n            }).then(jsonResponse => {\r\n            if (!jsonResponse.id) {\r\n                return;\r\n            }\r\n\r\n            userId = jsonResponse.id;\r\n            fetch(`https://api.spotify.com/v1/users/${userId}/playlists`, {\r\n                method: 'POST',\r\n                headers: headers,\r\n                body: JSON.stringify({name: playlistName})\r\n            }).then(response => {\r\n                return response.json();\r\n            }).then(jsonResponse => {\r\n                if (!jsonResponse.id) {\r\n                    return;\r\n                }\r\n\r\n                let playlistID = jsonResponse.id;\r\n\r\n                fetch(`https://api.spotify.com/v1/users/${userId}/playlists/${playlistID}/tracks`, {\r\n                    method: 'POST',\r\n                    headers: headers,\r\n                    body: JSON.stringify({uris: trackURIs})\r\n                })\r\n            })\r\n\r\n        })\r\n    }\r\n\r\n};\r\n\r\nexport default Spotify;"]}